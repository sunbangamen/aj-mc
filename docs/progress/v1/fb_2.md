
---

````markdown
# Problem Breakdown Command (v1.1 보강판)

**Usage:** `해결해야 할 문제나 기능을 입력하세요`

**Input:** Phase 5: 현장별 상세 모니터링 개발 - 측정 로그 시스템 + 데이터 시각화 (차트)

---

## 문제 분석

### 1. 문제 정의 및 복잡성 평가
- **문제**: Firebase 실시간 센서 데이터를 위한 측정 이력 테이블과 Recharts 기반 실시간 차트 구현
- **복잡성 수준**: 중간
- **예상 소요 시간**: 4-6시간
- **주요 도전 과제**:
  - Firebase 히스토리 데이터 구조 설계
  - 실시간 차트 업데이트 성능
  - 테이블/차트 동기화 UX
  - 모바일 반응형 차트/테이블 구현

### 2. 범위 및 제약조건
- **포함 범위**:
  - 최근 20개 측정 로그 테이블 (시간|거리값|상태)
  - Recharts 실시간 라인 차트
  - 모바일 반응형 디자인
- **제외 범위**:
  - 데이터 내보내기 (CSV/Excel)
  - 알림 시스템
  - 커스텀 시간 범위 선택
- **제약조건**:
  - 기존 Firebase 데이터 구조 활용
  - 현재 React 아키텍처 유지
- **전제조건**:
  - Phase 1-4 완료 (✅ 완료됨)
  - Recharts 라이브러리 설치됨

---

## 작업 분해

### Phase 1: 데이터 구조 및 히스토리 시스템 설계
**목표**: 측정 이력을 위한 Firebase 데이터 구조 및 훅 개발

| 작업 | 설명 | 완료 기준 (DoD) | 우선순위 |
|------|------|-----------------|----------|
| 1.1 Firebase 히스토리 데이터 구조 설계 | `/sensors/{site}/history/{timestamp}` 경로 설계 | 데이터 구조 문서화 및 테스트 데이터 생성 | 높음 |
| 1.2 히스토리 데이터 훅 개발 | `useSensorHistory(siteId, limit=20)` 훅 구현 | 최근 20개 데이터 실시간 조회 성공 | 높음 |
| 1.3 데이터 유틸리티 함수 작성 | 시간 포맷팅, 상태 변환 등 공통 유틸리티 | 타입 안전성 및 단위 테스트 통과 | 중간 |

**데이터 스키마 예시**
```json
{
  "distance": 150,
  "timestamp": 1694962800000,
  "status": "normal"
}
````

---

### Phase 2: 측정 로그 테이블 구현

**목표**: 시간순 정렬된 측정 이력 테이블 완성

| 작업                           | 설명                                          | 완료 기준 (DoD)             | 의존성        |
| ---------------------------- | ------------------------------------------- | ----------------------- | ---------- |
| 2.1 MeasurementTable 컴포넌트 생성 | `src/components/MeasurementTable.jsx` 기본 구조 | 테이블 레이아웃 완성             | Phase 1 완료 |
| 2.2 실시간 데이터 연동               | `useSensorHistory` 훅 연결 및 자동 업데이트           | Firebase 데이터 변경 시 즉시 반영 | 2.1 완료     |
| 2.3 모바일 반응형 테이블              | CSS Grid/Flexbox로 모바일 최적화                   | 768px 이하에서 스크롤 가능한 테이블  | 2.2 완료     |
| 2.4 로딩/에러 상태 처리              | 스피너, 에러 메시지, 빈 데이터 처리                       | 모든 상태에서 적절한 UI 표시       | 2.3 완료     |

---

### Phase 3: Recharts 차트 시스템 구현

**목표**: 실시간 업데이트되는 시각화 차트 완성

| 작업                      | 설명                                            | 완료 기준 (DoD)        | 위험도 |
| ----------------------- | --------------------------------------------- | ------------------ | --- |
| 3.1 SensorChart 컴포넌트 생성 | `src/components/SensorChart.jsx` 기본 LineChart | Recharts 차트 렌더링 성공 | 낮음  |
| 3.2 실시간 차트 데이터 연동       | 히스토리 데이터를 차트 형태로 변환                           | 시간대별 거리값 그래프 표시    | 중간  |
| 3.3 차트 반응형 및 스타일링       | 모바일/데스크톱 대응, 색상 시스템 적용                        | 모든 화면 크기에서 정상 표시   | 중간  |
| 3.4 차트 실시간 업데이트         | 새 데이터 추가 시 부드러운 애니메이션                         | 500ms 이내 차트 업데이트   | 높음  |

---

### Phase 4: SiteMonitor 페이지 통합

**목표**: 기존 SiteMonitor에 테이블과 차트 통합

| 작업                      | 설명                               | 완료 기준 (DoD)            | 의존성          |
| ----------------------- | -------------------------------- | ---------------------- | ------------ |
| 4.1 SiteMonitor 레이아웃 확장 | 현재 거리값 + 차트 + 테이블 배치             | 3단 레이아웃 완성             | Phase 2,3 완료 |
| 4.2 컴포넌트 통합 및 성능 최적화    | MeasurementTable, SensorChart 추가 | 페이지 로딩 3초 이내           | 4.1 완료       |
| 4.3 모바일 UX 최적화          | 차트/테이블 세로 스크롤 배치                 | 모바일에서도 차트+20개 로그 접근 가능 | 4.2 완료       |

---

## 실행 계획

### 우선순위 매트릭스

```
긴급 & 중요              | 중요하지만 덜 긴급
-------------------------|------------------
1.1 데이터 구조 설계     | 2.3 모바일 반응형
1.2 히스토리 훅 개발     | 3.3 차트 스타일링

긴급하지만 덜 중요       | 덜 중요 & 덜 긴급
2.4 에러 처리            | 1.3 유틸리티 함수
3.4 차트 애니메이션      |
```

### 마일스톤

* **Day 1**: Phase 1 완료 (데이터 구조 + 훅)
* **Day 2**: Phase 2 완료 (측정 로그 테이블)
* **Day 3**: Phase 3 완료 (Recharts 차트)
* **Day 4**: Phase 4 완료 (통합 및 최적화)

---

## 위험 요소 및 대응 방안

| 위험 요소                 | 가능성 | 영향도 | 대응 방안                                       |
| --------------------- | --- | --- | ------------------------------------------- |
| Firebase 데이터 구조 변경 필요 | 중간  | 높음  | 기존 구조 최대한 활용, 점진적 마이그레이션                    |
| Recharts 성능 이슈        | 낮음  | 중간  | `limitToLast(20)` 쿼리, useMemo/React.memo 적용 |
| 모바일 반응형 복잡성           | 높음  | 중간  | CSS Grid 활용, 단계별 테스트                        |

---

## 품질 체크리스트

### 각 작업 완료 시 확인사항

* [ ] Firebase 실시간 업데이트 정상 동작
* [ ] Firebase 쿼리 `limitToLast(20)` 적용 확인
* [ ] 모바일(768px 이하)에서 UI 정상 표시
* [ ] 새 데이터 추가 시 차트+테이블 동기화 정상
* [ ] 네트워크 끊김/지연 시 에러 메시지 처리
* [ ] 코드 컨벤션 및 타입 안전성 준수
* [ ] 기존 페이지들과의 일관성 유지

### 전체 완료 기준

* [ ] 최근 20개 측정 데이터 테이블 표시
* [ ] 실시간 업데이트되는 라인 차트 표시
* [ ] PC/모바일 모두에서 정상 동작
* [ ] Firebase 데이터 변경 시 500ms 이내 UI 반영
* [ ] 기존 기능 영향 없음 (회귀 테스트)

---

## 리소스 및 참고자료

### 필요한 리소스

* **인력**: Frontend 개발자 1명
* **도구**: Recharts, Firebase Realtime Database
* **인프라**: 기존 Firebase 프로젝트 활용

### 학습 자료

* [Recharts 공식 문서](https://recharts.org/en-US/guide)
* [Firebase Realtime Database 쿼리](https://firebase.google.com/docs/database/web/lists-of-data)
* [CSS Grid 모바일 반응형](https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Grid_Layout)

### 유사 사례

* 기존 Dashboard.jsx의 실시간 업데이트 패턴
* SiteMonitor.jsx의 단일 센서 데이터 처리 방식

---

**💡 추가 고려사항**

* Firebase 쿼리 비용 최적화 (orderBy, limitToLast 활용)
* 차트 데이터 포인트 개수 제한으로 성능 확보
* 테이블/차트 스크롤/애니메이션 동기화 UX 보강
* 컴포넌트 재사용성을 고려한 설계

```

---
